# 타입스크립트 컴파일

## 1. 런타임과 컴파일타임의 차이
- 컴파일타임: **소스코드를 실행 가능한 프로그램으로 변환하는 과정**입니다. 보통 고급 언어 코드를 기계가 이해할 수 있는 형태로 바꾸는 것을 말합니다.
- 런타임: **프로그램이 실행되는 시점을 의미**합니다. 즉, 사용자가 프로그램을 실행했을 때 일어나는 모든 과정이 런타임입니다.
> 인간이 소스 코드 작성 -> 컴파일 타임 -> 런타임

## 2. 자바스크립트의 런타임
자바스크립트가 실행되는 환경을 의미하며, 대표적인 JS 런타임으로 인터넷 브라우저와, Node.js 등이 있다.

### 주요 구성 요소
- 자바스크립트 엔진(V8 등): 코드를 해석하고 실행합니다.
- 웹 API: 브라우저에서 제공하는 타이머, DOM 등 기능입니다.
- 콜백 큐 / 이벤트 루프 / 렌더 큐: 비동기 작업을 처리하는 구조입니다.
- 
### 자바스크립트는 인터프리터 언어?
전통적으로는 JS가 **인터프리터 언어**로 분류되었지만 **현대 JS 엔진(V8 등)** 은 실행 속도를 높이기 위해 **컴파일 단계도 포함**합니다.
→ 따라서 JS는 **인터프리터 + 컴파일** 언어의 특성을 함께 가집니다.


## 3. 타입스크립트의 컴파일
- 타입스크립트(TypeScript, TS)는 자바스크립트에 정적 타입 검사 기능을 추가한 언어입니다.
- TS 코드는 실행할 수 없고 먼저 **자바스크립트(JS)** 로 변환되어야 합니다. 이 과정을 **컴파일 또는 트랜스파일(transpile)** 이라고 부릅니다.

### 트랜스파일이란?
- 고급 언어에서 다른 고급 언어로 바꾸는 과정입니다.
- TS → JS 변환은 트랜스파일의 대표적인 예입니다.
- 또 다른 예로는 Babel이 있습니다. Babel은 최신 JS 문법(ES6+)을 구버전 JS(ES5 이하)로 변환합니다.

### 타입스크립트 컴파일 결과
- `.ts` 파일 → `.js` 파일로 변환
- 타입 정보는 컴파일 후 모두 제거

## 4. 타입스크립트의 컴파일 과정
TS 컴파일은 다음과 같은 과정을 거칩니다:
1. TS 소스코드 → AST(추상 구문 트리) 생성 (tsc)
2. AST에 대해 타입 검사 수행 (tsc)
3. 타입스크립트 AST → 자바스크립트 코드 변환 (tsc)
4. JS 코드 → JS AST 생성 (런타임)
5. JS AST → 바이트코드 변환 (런타임)
6. 바이트코드 실행 → 프로그램 동작 (런타임)

> 📌 AST(Abstract Syntax Tree): 컴파일러가 코드를 이해하기 위해 만든 트리 형태의 구조입니다.
> 이 구조는 코드의 구성 요소(함수, 변수 등)를 계층적으로 표현합니다.

> 🔍 참고: 타입 정보는 1~2단계에서만 사용되며, 이후에는 제거됩니다.
> 즉, 타입은 코드 실행에는 영향을 주지 않고, 오직 컴파일타임에서만 활용됩니다.

## 5. 타입스크립트 컴파일러의 역할
타입스크립트 컴파일러(tsc)는 크게 두 가지 역할을 합니다:

### 1. 코드 검사기
- 실행 전에 타입 오류, 문법 오류를 잡아냅니다.
 JS에서는 통과되지만 런타임에서 에러 나는 코드도 TS에서는 컴파일 단계에서 경고를 줍니다.
```js
const developer = {
  work() {
    console.log("working...");
  },
};

developer.work(); // 정상
developer.sleep(); // 런타임 오류 발생 (sleep은 정의되지 않음)
```
이 코드는 JS에서는 컴파일 오류 없이 실행되지만 TS에서는 developer.sleep()에서 에러를 사전에 잡아냅니다.
→ 즉, 타입스크립트는 런타임 에러를 컴파일타임에 미리 발견할 수 있도록 도와줍니다.

### 2. 코드 변환기 역할
- 최신 문법과 타입 정보를 제거하고 JS로 변환합니다.
- 결과 코드는 구버전 JS도 지원합니다.
```ts
// TypeScript 코드
type Fruit = "banana" | "apple" | "mango";
const fruitBox: Fruit[] = ["banana", "apple", "mango"];

const welcome = (name: string) => {
  console.log(`hi! ${name} :)`);
};
```
컴파일 후
```js
// JavaScript 코드
"use strict";
var fruitBox = ["banana", "apple", "mango"];
var welcome = function (name) {
    console.log("hi! ".concat(name, " :)"));
};
```
타입 정보는 전부 제거되고 JS 문법으로만 남습니다.

---
#### 타입스크립트 vs Babel
타입과 바벨이 무슨 차이냐? 하면
| 항목    | 타입스크립트(tsc)   | 바벨(Babel)             |
| ----- | ------------- | --------------------- |
| 주된 역할 | 타입 검사 + 코드 변환 | 코드 변환만                |
| 타입 검사 | O             | X                     |
| 코드 변환 | ES6 → ES5     | ES6 → ES5             |
| 사용 예시 | TS 개발 시 필수    | 최신 JS 문법을 사용할 때 주로 사용 |

---

## 6. 타입스크립트 컴파일러의 내부 구조
TS 컴파일러는 총 5단계를 통해 타입 검사와 코드 변환을 수행합니다.

### 1. 프로그램 (Program)
- tsc 명령으로 실행되며 tsconfig.json 설정을 따릅니다.
- 전체 컴파일을 관리하며, 필요한 파일과 모듈을 불러옵니다.

### 2. 스캐너 (Scanner)
- 소스코드를 토큰(token) 단위로 분해합니다.
- 예: const age = 30; → const, age, =, 30, ;

### 3. 파서 (Parser)
- 토큰을 이용해 **AST(Abstract Syntax Tree, 추상 구문 트리)** 를 만듭니다.
- AST는 코드의 구조를 계층적으로 표현한 나무(tree) 형태의 자료구조입니다.
```ts
function greet() {
  console.log("hello");
}
```
```scss
//트리형태
Program
├── FunctionDeclaration (greet)
│   └── Block
│       └── ExpressionStatement
│           └── CallExpression (console.log("hello"))


```

### 4. 바인더 (Binder)
- AST의 각 노드에 **심볼(Symbol)**을 연결합니다.
- 심볼은 나중에 타입 검사를 위한 데이터입니다.
```ts
export interface Symbol {
  flags: SymbolFlags;
  escapedName: string;
  declarations?: Declaration[];
}
```
### 5. 체커(Checker)와 이미터(Emitter)
체커
- AST를 탐색하며 타입 오류를 검사합니다.
- 전체 컴파일 과정 중 가장 많은 연산을 차지합니다.
이미터
- 최종적으로 **자바스크립트 코드(.js)** 와 **타입 선언 파일(.d.ts)** 을 생성합니다.
- 내부적으로 emitFiles() 함수를 통해 변환이 이뤄집니다.

## ❓ 초심자를 위한 Q&A

- ❓ 타입스크립트를 사용하면 무조건 안전한가요?
> 아니요. 타입 검사는 정적 분석에 기반하기 때문에 런타임의 실제 동작까지 100% 보장하진 않습니다. 하지만 대부분의 오류를 미리 잡을 수 있어 큰 도움이 됩니다.

- ❓ 타입 정보는 어디에 쓰이나요?
> 타입 정보는 오직 컴파일 단계에서 코드 검사에만 사용됩니다.
> 브라우저에서 실행되는 JS 코드에는 포함되지 않습니다.
