## 3. 타입 좁히기 - 식별할 수 있는 유니온(Discriminated Unions)

### 에러 정의하기

```tsx
/* 에러 타입 */
type TextError = {
	errorCode： string;
	errorMessage： string;
}；
type ToastError = {
	errorCode： string;
	errorMessage： string;
	toastShowDuration： number; // 토스트를 띄워줄 시간
}
type AlertError = {
	errorCode： string;
	errorMessage： string;
	onConfirm： () => void; // 얼럿 창의 확인 버튼을 누른 뒤 액션
}；

/* 위 에러 타입의 유니온 타입을 원소로 하는 배열 */
type ErrorFeedbackType = TextError | ToastError | AlertError;
const errorArr： ErrorFeedbackType[] = [
	{ errorCode： "100", errorMessage： "텍스트 에러" },
	{ errorCode： "200", errorMessage： "토스트 에러", toastShowDuration： 3000 },
	{ errorCode： "300", errorMessage： "얼럿 에러", onConfirm： () => {} },
]；
```

이제 다양한 에러 객체를 관리할 수 있다. 이 때 배열에 에러 타입별로 정의한 필드를 가지는 에러 객체가 포함되길 원한다고 해보자.

그러면 다음 객체처럼 ToastError의 toastShowDuration 필드와 AlertError의 onConfirm 필드를 모두 가지면 에러를 뱉어야 한다.

```tsx
const errorArr: ErrorFeedbackType[] = [
	// ...
	{
		errorCode： "999",
		errorMessage： "잘못된 에러",
		toastShowDuration： 3000,
		onConfirm： () => {},
	}, // expected error
]；
```

하지만 우리의 Js는 덕 타이핑 언어이기 때문에 타입 에러를 뱉지 않는다. ㅋㅋ

### 식별할 수 있는 유니온

따라서 에러 타입 구분이 필요하다. 비슷한 구조를 가지더라도 서로 호환되지 않도록..

이 때 적용할 수 있는 방법이 타입 간의 구조 호환을 막기 위해 타입마다 판별자를 달아줘서 구분하는 것이다.

1. 개별 타입에 식별 가능한 판별자를 넣는다.
2. 유니온으로 개별 타입을 묶는다.
3. 판별자를 활용하여 타입을 좁혀 사용한다.

```tsx
// 1️⃣ 개별 에러 타입 정의
interface NetworkError {
  code: 100; // 식별자
  message: string;
  status: number;
}

interface ValidationError {
  code: 200; // 식별자
  message: string;
  field: string;
}

interface AuthError {
  code: 300; // 식별자
  message: string;
  expired: boolean;
}

// 2️⃣ 유니온으로 묶기
type AppError = NetworkError | ValidationError | AuthError;

// 3️⃣ 판별자(code)를 이용한 타입 좁히기
function handleError(error: AppError) {
  switch (error.code) {
    case 100:
      console.log(
        `🌐 [NetworkError] ${error.message} (status: ${error.status})`
      );
      break;

    case 200:
      console.log(
        `⚠️ [ValidationError] ${error.field} 필드 오류 - ${error.message}`
      );
      break;

    case 300:
      console.log(
        error.expired
          ? `🔒 [AuthError] 세션 만료`
          : `🚫 [AuthError] 인증 실패 - ${error.message}`
      );
      break;
  }
}

// 4️⃣ 사용 예시
handleError({ code: 100, message: "서버 연결 실패", status: 500 });
handleError({ code: 200, message: "이메일 형식이 잘못됨", field: "email" });
handleError({ code: 300, message: "토큰 만료", expired: true });

```